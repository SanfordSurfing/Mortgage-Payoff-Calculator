# 域名配置和安全更新说明

本文档说明已完成的域名配置更新和安全优化。

## ✅ 已完成的更新

### 1. 域名配置更新

所有相关文件已更新为使用域名：`mortgage-payoff-calculator.top`

#### 更新的文件：

1. **`app/sitemap.ts`**
   - 默认域名：`https://mortgage-payoff-calculator.top`
   - 支持通过环境变量 `NEXT_PUBLIC_SITE_URL` 覆盖

2. **`app/robots.ts`**
   - 默认域名：`https://mortgage-payoff-calculator.top`
   - 支持通过环境变量 `NEXT_PUBLIC_SITE_URL` 覆盖

3. **`app/layout.tsx`**
   - OpenGraph URL：`https://mortgage-payoff-calculator.top`
   - 结构化数据（JSON-LD）中的 URL：`https://mortgage-payoff-calculator.top`

### 2. 安全头配置（解决证书问题）

在 `next.config.js` 中添加了安全头配置，包括：

- **Strict-Transport-Security (HSTS)**
  - 强制浏览器使用 HTTPS 连接
  - 有效期：1年
  - 包含子域名

- **X-Content-Type-Options: nosniff**
  - 防止 MIME 类型嗅探攻击

- **X-Frame-Options: DENY**
  - 防止点击劫持攻击

- **X-XSS-Protection: 1; mode=block**
  - 启用 XSS 过滤器

- **Referrer-Policy: strict-origin-when-cross-origin**
  - 控制引用信息传递

- **Permissions-Policy**
  - 限制浏览器功能访问

## 🔒 关于浏览器提示"不安全"的问题

### 可能的原因：

1. **DNS 传播未完成**
   - 证书已下发，但 DNS 记录可能还在传播中
   - 解决方法：等待 1-2 小时

2. **浏览器缓存**
   - 浏览器可能缓存了旧的 HTTP 连接
   - 解决方法：清除浏览器缓存或使用隐私模式

3. **混合内容（Mixed Content）**
   - 页面中加载了 HTTP 资源
   - 已检查：所有外部资源都使用 HTTPS ✅

4. **证书链不完整**
   - Vercel 通常会自动处理，但可能需要时间
   - 解决方法：等待证书完全生效

5. **需要强制 HTTPS 重定向**
   - 已添加 HSTS 头，强制 HTTPS ✅

### 验证步骤：

1. **检查证书状态**
   ```bash
   # 使用命令行检查证书
   openssl s_client -connect mortgage-payoff-calculator.top:443 -servername mortgage-payoff-calculator.top
   ```

2. **检查 DNS 记录**
   ```bash
   dig mortgage-payoff-calculator.top
   ```

3. **使用在线工具检查**
   - https://www.ssllabs.com/ssltest/analyze.html?d=mortgage-payoff-calculator.top
   - https://securityheaders.com/?q=https://mortgage-payoff-calculator.top

## 📝 Vercel 环境变量配置

### 建议在 Vercel 中设置环境变量：

**变量名：** `NEXT_PUBLIC_SITE_URL`  
**变量值：** `https://mortgage-payoff-calculator.top`  
**环境：** Production, Preview, Development（全部勾选）

### 设置步骤：

1. 进入 Vercel 项目设置
2. 找到 "Environment Variables"
3. 添加变量：
   - Key: `NEXT_PUBLIC_SITE_URL`
   - Value: `https://mortgage-payoff-calculator.top`
   - 选择所有环境
4. 保存后重新部署

## 🚀 部署后的验证清单

- [ ] 访问 `https://mortgage-payoff-calculator.top` 正常加载
- [ ] 浏览器显示安全锁（绿色）
- [ ] 访问 `https://mortgage-payoff-calculator.top/sitemap.xml` 正常
- [ ] 访问 `https://mortgage-payoff-calculator.top/robots.txt` 正常
- [ ] Google Analytics 正常工作
- [ ] 在 Google Search Console 中提交 sitemap

## 🔧 如果问题仍然存在

### 1. 清除浏览器缓存
- Chrome: Ctrl+Shift+Delete (Windows) 或 Cmd+Shift+Delete (Mac)
- 选择"缓存的图片和文件"
- 清除数据

### 2. 使用隐私模式测试
- 打开隐私/无痕模式
- 访问网站测试

### 3. 检查 Vercel 域名设置
- 确认域名已正确添加到 Vercel 项目
- 确认 DNS 记录配置正确
- 等待证书完全生效（可能需要几分钟到几小时）

### 4. 联系 Vercel 支持
- 如果证书显示已下发但浏览器仍提示不安全
- 可能是 Vercel 端的配置问题

## 📌 重要提示

1. **DNS 传播时间**：通常需要 1-48 小时，大多数情况下 1-2 小时
2. **证书生效时间**：Vercel 自动证书可能需要几分钟到几小时完全生效
3. **浏览器缓存**：清除缓存或使用隐私模式测试
4. **HTTPS 强制**：已通过 HSTS 头强制 HTTPS，确保所有连接都使用安全协议

## 🎉 更新完成

所有域名配置和安全优化已完成。代码已准备好提交和部署。

